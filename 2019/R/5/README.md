# Day 5
* author: David Mas
* date: 21/12/2019
## Usage
Convert script to README.md, run from console in the 2019 directory.
There might be a better way to do this.


```r
if (interactive()){
  rmd_file = knitr::spin("script.R", knit = FALSE)
  knitr::knit(rmd_file,output = "README.md")
  fs::file_delete(rmd_file)
}
```

## Problem 1 & 2

Today I have included both solutions in the same function because it was
simply too big. Basically itÂ´s a modification of day4 computer.
I had to modify the get_digits function because it was giving
wrong values for 10, 100 etc.

I now introduced a optcode parser to separate that part from the computer 
one. The computer now is basically a set of else ifs that will make the 
computer commands. As always the 0-based (puzzle) to 1-based (puzzle) gave
me a lot of headaches.

Also I had a stupid bug in the output part that was driving me crazy, 
the result was okay but the output was failing for whatever reason...



```r
# from day 4, modified
# from here https://stackoverflow.com/questions/19764244
get_digits <- function(x){
  dig <- nchar(x)
  vec1 <- 10^(dig:1)
  vec2 <- vec1/10
  (x%%vec1)%/%vec2
}

parse_optcode <- function(int){
  
  opt = int%%100
  params_opt = int%/%100
  params_opt_dig = get_digits(params_opt)
  res = list()
  # first number of parameters
  if (opt %in% c( 1,2,7,8)){
    nparams = 3
  } else if (opt %in% c(5,6)) {
    nparams = 2
  } else { # this is 3 and 4
    nparams = 1
  }
  
  # generate params modes
  param_modes = integer(nparams)
  idx_1 = length(param_modes) - length(params_opt_dig) + 1
  param_modes[idx_1:length(param_modes)] = params_opt_dig
  param_modes = rev(param_modes) # the order is reversed
  
  return(list(opt = opt,
              nparams = nparams,
              param_modes = param_modes))
}
  
gravity_assist_recursive <- function(x,
                                     iteration=1,
                                     input,
                                     output = NULL) {
  

  opt = parse_optcode(x[iteration])
  
  if (opt$opt == 99){
    return(list(x = x,
                output = output))
  } else {
    param_modes = opt$param_modes
    params_idx = (iteration+1):(iteration+opt$nparams)
    params = x[params_idx]
    params_values = params
    params_values[param_modes == 0] = x[params[param_modes == 0]+1]
    # this is not needed, but might be in the future
    # params[param_modes == 1] = params[param_modes == 1]
    
    # this is the general part 
    ipointer = iteration + opt$nparams + 1
    
    ## the computer part
    if (opt$opt == 1){
      x[params[3]+1] = sum(params_values[1:2])
    } else if (opt$opt == 2){
      x[params[3]+1] = prod(params_values[1:2])
    } else if (opt$opt == 3){
      stopifnot(length(params) == 1)
      x[params+1] = input
    } else if (opt$opt == 4){
      # maybe check params is length 1
      stopifnot(length(params) == 1)
      if (is.na(params_values)){
         browser()
      }
      output = c(output,params_values)
    } else if (opt$opt == 5){
      if(params_values[1] != 0){
        ipointer = params_values[2] + 1
      }
    } else if (opt$opt == 6){
      if(params_values[1] == 0){
        ipointer = params_values[2] + 1
      }
    } else if (opt$opt == 7){
      if(params_values[1] < params_values[2]){
        x[params[3]+1] = 1 # params because position will always be mode 0
      } else {
        x[params[3]+1] = 0
      }
    } else if (opt$opt == 8){
      if(params_values[1] == params_values[2]){
        x[params[3]+1] = 1 # position will always be mode 0
      } else {
        x[params[3]+1] = 0
      }
    } else{
      browser()
      stop("error")
    }

    return(gravity_assist_recursive(x,
                                    iteration = ipointer,
                                    input = input,
                                    output = output))
  }
}
```

Here are the activities of problem 1


```r
gravity_assist_recursive(c(1002,4,3,4,33),input = 1)
```

```
## $x
## [1] 1002    4    3    4   99
## 
## $output
## NULL
```

```r
readLines("input.txt") -> program
program = as.numeric(unlist(stringr::str_split(program,",")))
gravity_assist_recursive(program,input = 1)
```

```
## $x
##   [1]       3     225       1     225       6       6    1101       1
##   [9]     238     225     104       0       1     191     196     224
##  [17]    1001     224     -85     224       4     224    1002     223
##  [25]       8     223    1001     224       4     224       1     223
##  [33]     224     223    1101      45      50     225    1102      61
##  [41]      82     225     101      44      39     224     101    -105
##  [49]     224     224       4     224     102       8     223     223
##  [57]     101       5     224     224       1     224     223     223
##  [65]     102      14     187     224     101    -784     224     224
##  [73]       4     224     102       8     223     223     101       7
##  [81]     224     224       1     224     223     223    1001     184
##  [89]      31     224    1001     224    -118     224       4     224
##  [97]     102       8     223     223    1001     224       2     224
## [105]       1     223     224     223    1102      91      18     225
## [113]       2      35     110     224     101    -810     224     224
## [121]       4     224     102       8     223     223     101       3
## [129]     224     224       1     223     224     223    1101      76
## [137]      71     224    1001     224    -147     224       4     224
## [145]     102       8     223     223     101       2     224     224
## [153]       1     224     223     223    1101       7      16     225
## [161]    1102      71      76     224     101   -5396     224     224
## [169]       4     224    1002     223       8     223     101       5
## [177]     224     224       1     224     223     223    1101      72
## [185]      87     225    1101      56      77     225    1102      70
## [193]      31     225    1102      29      15     225    1002     158
## [201]      14     224    1001     224    -224     224       4     224
## [209]     102       8     223     223     101       1     224     224
## [217]       1     223     224     223       4     223      99 9938601
## [225]       1     435     677       0       0       0       0       0
## [233]       0       0       0       0       0       0    1105       0
## [241]   99999    1105     227     247    1105       1   99999    1005
## [249]     227   99999    1005       0     256    1105       1   99999
## [257]    1106     227   99999    1106       0     265    1105       1
## [265]   99999    1006       0   99999    1006     227     274    1105
## [273]       1   99999    1105       1     280    1105       1   99999
## [281]       1     225     225     225    1101     294       0       0
## [289]     105       1       0    1105       1   99999    1106       0
## [297]     300    1105       1   99999       1     225     225     225
## [305]    1101     314       0       0     106       0       0    1105
## [313]       1   99999    1007     226     226     224    1002     223
## [321]       2     223    1006     224     329    1001     223       1
## [329]     223       8     226     677     224    1002     223       2
## [337]     223    1005     224     344    1001     223       1     223
## [345]     107     226     677     224    1002     223       2     223
## [353]    1006     224     359    1001     223       1     223       8
## [361]     677     677     224    1002     223       2     223    1005
## [369]     224     374    1001     223       1     223    1108     226
## [377]     226     224    1002     223       2     223    1005     224
## [385]     389    1001     223       1     223       7     677     226
## [393]     224    1002     223       2     223    1005     224     404
## [401]     101       1     223     223       7     226     226     224
## [409]     102       2     223     223    1006     224     419    1001
## [417]     223       1     223    1108     226     677     224     102
## [425]       2     223     223    1005     224     434    1001     223
## [433]       1     223    1107     226     226     224    1002     223
## [441]       2     223    1006     224     449    1001     223       1
## [449]     223    1007     677     677     224     102       2     223
## [457]     223    1006     224     464    1001     223       1     223
## [465]     107     226     226     224    1002     223       2     223
## [473]    1005     224     479     101       1     223     223    1107
## [481]     677     226     224    1002     223       2     223    1005
## [489]     224     494    1001     223       1     223    1008     677
## [497]     677     224     102       2     223     223    1005     224
## [505]     509     101       1     223     223     107     677     677
## [513]     224     102       2     223     223    1005     224     524
## [521]    1001     223       1     223    1108     677     226     224
## [529]    1002     223       2     223    1005     224     539    1001
## [537]     223       1     223       7     226     677     224     102
## [545]       2     223     223    1006     224     554    1001     223
## [553]       1     223       8     677     226     224    1002     223
## [561]       2     223    1006     224     569     101       1     223
## [569]     223     108     226     226     224    1002     223       2
## [577]     223    1006     224     584    1001     223       1     223
## [585]    1107     226     677     224    1002     223       2     223
## [593]    1006     224     599     101       1     223     223    1008
## [601]     226     226     224     102       2     223     223    1005
## [609]     224     614    1001     223       1     223    1007     226
## [617]     677     224    1002     223       2     223    1006     224
## [625]     629    1001     223       1     223     108     677     226
## [633]     224     102       2     223     223    1005     224     644
## [641]     101       1     223     223    1008     226     677     224
## [649]    1002     223       2     223    1005     224     659     101
## [657]       1     223     223     108     677     677     224    1002
## [665]     223       2     223    1006     224     674    1001     223
## [673]       1     223       4     223      99     226
## 
## $output
##  [1]       0       0       0       0       0       0       0       0
##  [9]       0 9938601
```

Here are the activities of problem 2


```r
test = c(3,21,1008,21,8,20,1005,20,22,107,8,21,20,1006,20,31,1106,0,36,98,0,0,
         1002,21,125,20,4,20,1105,1,46,104,999,1105,1,46,1101,1000,1,20,4,20,
         1105,1,46,98,99)
gravity_assist_recursive(test,input = 7)
```

```
## $x
##  [1]    3   21 1008   21    8   20 1005   20   22  107    8   21   20 1006
## [15]   20   31 1106    0   36   98    0    7 1002   21  125   20    4   20
## [29] 1105    1   46  104  999 1105    1   46 1101 1000    1   20    4   20
## [43] 1105    1   46   98   99
## 
## $output
## [1] 999
```

```r
gravity_assist_recursive(test,input = 8)
```

```
## $x
##  [1]    3   21 1008   21    8   20 1005   20   22  107    8   21   20 1006
## [15]   20   31 1106    0   36   98 1000    8 1002   21  125   20    4   20
## [29] 1105    1   46  104  999 1105    1   46 1101 1000    1   20    4   20
## [43] 1105    1   46   98   99
## 
## $output
## [1] 1000
```

```r
gravity_assist_recursive(test,input = 9)
```

```
## $x
##  [1]    3   21 1008   21    8   20 1005   20   22  107    8   21   20 1006
## [15]   20   31 1106    0   36   98 1001    9 1002   21  125   20    4   20
## [29] 1105    1   46  104  999 1105    1   46 1101 1000    1   20    4   20
## [43] 1105    1   46   98   99
## 
## $output
## [1] 1001
```

```r
gravity_assist_recursive(program,input = 5)
```

```
## $x
##   [1]     314     225       1     225       6       6    1105       1
##   [9]     238     225     104       0       1     191     196     224
##  [17]    1001     224     -85     224       4     224    1002     223
##  [25]       8     223    1001     224       4     224       1     223
##  [33]     224     223    1101      45      50     225    1102      61
##  [41]      82     225     101      44      39     224     101    -105
##  [49]     224     224       4     224     102       8     223     223
##  [57]     101       5     224     224       1     224     223     223
##  [65]     102      14     187     224     101    -784     224     224
##  [73]       4     224     102       8     223     223     101       7
##  [81]     224     224       1     224     223     223    1001     184
##  [89]      31     224    1001     224    -118     224       4     224
##  [97]     102       8     223     223    1001     224       2     224
## [105]       1     223     224     223    1102      91      18     225
## [113]       2      35     110     224     101    -810     224     224
## [121]       4     224     102       8     223     223     101       3
## [129]     224     224       1     223     224     223    1101      76
## [137]      71     224    1001     224    -147     224       4     224
## [145]     102       8     223     223     101       2     224     224
## [153]       1     224     223     223    1101       7      16     225
## [161]    1102      71      76     224     101   -5396     224     224
## [169]       4     224    1002     223       8     223     101       5
## [177]     224     224       1     224     223     223    1101      72
## [185]      87     225    1101      56      77     225    1102      70
## [193]      31     225    1102      29      15     225    1002     158
## [201]      14     224    1001     224    -224     224       4     224
## [209]     102       8     223     223     101       1     224     224
## [217]       1     223     224     223       4     223      99 4283952
## [225]       0      20     677       0       0       0       0       0
## [233]       0       0       0       0       0       0    1105       0
## [241]   99999    1105     227     247    1105       1   99999    1005
## [249]     227   99999    1005       0     256    1105       1   99999
## [257]    1106     227   99999    1106       0     265    1105       1
## [265]   99999    1006       0   99999    1006     227     274    1105
## [273]       1   99999    1105       1     280    1105       1   99999
## [281]       1     225     225     225    1101     294       0       0
## [289]     105       1       0    1105       1   99999    1106       0
## [297]     300    1105       1   99999       1     225     225     225
## [305]    1101     314       0       0     106       0       0    1105
## [313]       1   99999    1007     226     226     224    1002     223
## [321]       2     223    1006     224     329    1001     223       1
## [329]     223       8     226     677     224    1002     223       2
## [337]     223    1005     224     344    1001     223       1     223
## [345]     107     226     677     224    1002     223       2     223
## [353]    1006     224     359    1001     223       1     223       8
## [361]     677     677     224    1002     223       2     223    1005
## [369]     224     374    1001     223       1     223    1108     226
## [377]     226     224    1002     223       2     223    1005     224
## [385]     389    1001     223       1     223       7     677     226
## [393]     224    1002     223       2     223    1005     224     404
## [401]     101       1     223     223       7     226     226     224
## [409]     102       2     223     223    1006     224     419    1001
## [417]     223       1     223    1108     226     677     224     102
## [425]       2     223     223    1005     224     434    1001     223
## [433]       1     223    1107     226     226     224    1002     223
## [441]       2     223    1006     224     449    1001     223       1
## [449]     223    1007     677     677     224     102       2     223
## [457]     223    1006     224     464    1001     223       1     223
## [465]     107     226     226     224    1002     223       2     223
## [473]    1005     224     479     101       1     223     223    1107
## [481]     677     226     224    1002     223       2     223    1005
## [489]     224     494    1001     223       1     223    1008     677
## [497]     677     224     102       2     223     223    1005     224
## [505]     509     101       1     223     223     107     677     677
## [513]     224     102       2     223     223    1005     224     524
## [521]    1001     223       1     223    1108     677     226     224
## [529]    1002     223       2     223    1005     224     539    1001
## [537]     223       1     223       7     226     677     224     102
## [545]       2     223     223    1006     224     554    1001     223
## [553]       1     223       8     677     226     224    1002     223
## [561]       2     223    1006     224     569     101       1     223
## [569]     223     108     226     226     224    1002     223       2
## [577]     223    1006     224     584    1001     223       1     223
## [585]    1107     226     677     224    1002     223       2     223
## [593]    1006     224     599     101       1     223     223    1008
## [601]     226     226     224     102       2     223     223    1005
## [609]     224     614    1001     223       1     223    1007     226
## [617]     677     224    1002     223       2     223    1006     224
## [625]     629    1001     223       1     223     108     677     226
## [633]     224     102       2     223     223    1005     224     644
## [641]     101       1     223     223    1008     226     677     224
## [649]    1002     223       2     223    1005     224     659     101
## [657]       1     223     223     108     677     677     224    1002
## [665]     223       2     223    1006     224     674    1001     223
## [673]       1     223       4     223      99     226
## 
## $output
## [1] 4283952
```

